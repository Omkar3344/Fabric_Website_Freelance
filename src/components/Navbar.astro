<header class="fixed inset-x-0 top-0 z-50 w-full border-b border-white/20 backdrop-blur-md" data-site-header>
    <div class="site-header-inner mx-auto flex w-full max-w-6xl items-center justify-between px-4 md:px-6">
        <a href="/" class="flex items-center">
            <img src="/logo.svg" alt="Fabric Loom" class="h-8 w-auto md:h-10" />
        </a>
        <nav class="hidden items-center justify-center gap-6 text-sm font-medium md:flex">
            <a href="/" class="transition hover:text-[#d4a373]">Home</a>
            <a href="/about" class="transition hover:text-[#d4a373]">About</a>
            <a href="/products" class="transition hover:text-[#d4a373]">Products</a>
            <a href="/contact" class="transition hover:text-[#d4a373]">Contact</a>
        </nav>
        <div class="flex items-center justify-end gap-3">
            <button
                type="button"
                data-search-toggle
                class="hidden items-center gap-2 rounded-full border border-[#d4a373]/40 bg-transparent px-3 py-1.5 text-sm font-medium text-[#fefae0] shadow-sm backdrop-blur transition hover:border-[#d4a373] hover:text-[#d4a373] md:flex"
            >
                <svg
                    aria-hidden="true"
                    class="h-4 w-4 text-current"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <circle cx="11" cy="11" r="7"></circle>
                    <line x1="20" y1="20" x2="16.5" y2="16.5"></line>
                </svg>
                <span>Search</span>
            </button>
            <a
                href="/contact"
                class="hidden rounded-full bg-[#d4a373] px-4 py-1.5 text-sm font-semibold text-[#fefae0] shadow-sm transition hover:bg-[#c68d58] md:inline-block"
            >
                Request a call
            </a>
            <button
                type="button"
                data-nav-toggle
                class="inline-flex items-center justify-center rounded-full border border-[#d4a373]/40 bg-transparent p-2 text-[#fefae0] shadow-sm backdrop-blur transition hover:border-[#d4a373] hover:text-[#d4a373] md:hidden"
                aria-expanded="false"
                aria-controls="mobile-menu"
            >
                <span class="sr-only">Toggle navigation</span>
                <svg
                    aria-hidden="true"
                    class="h-5 w-5 text-current"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                >
                    <line x1="4" y1="7" x2="20" y2="7"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="17" x2="20" y2="17"></line>
                </svg>
            </button>
        </div>
    </div>
    <div id="mobile-menu" class="hidden border-t border-[#e9edc9]/80 bg-[#fefae0] md:hidden">
        <nav class="flex flex-col gap-1 px-4 py-4 text-sm font-medium">
            <a href="/" class="rounded-md px-3 py-2 transition hover:bg-[#e9edc9]">Home</a>
            <a href="/about" class="rounded-md px-3 py-2 transition hover:bg-[#e9edc9]">About</a>
            <a href="/products" class="rounded-md px-3 py-2 transition hover:bg-[#e9edc9]">Products</a>
            <a href="/contact" class="rounded-md px-3 py-2 transition hover:bg-[#e9edc9]">Contact</a>
            <button
                type="button"
                data-search-toggle
                class="mt-2 flex w-full items-center justify-center gap-2 rounded-full border border-[#e9edc9] bg-white px-3 py-2 text-sm font-semibold text-slate-700 transition hover:border-[#d4a373] hover:text-[#d4a373]"
            >
                <svg
                    aria-hidden="true"
                    class="h-4 w-4 text-current"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <circle cx="11" cy="11" r="7"></circle>
                    <line x1="20" y1="20" x2="16.5" y2="16.5"></line>
                </svg>
                <span>Search the site</span>
            </button>
        </nav>
    </div>
    <section
        data-search-panel
        class="invisible fixed inset-x-0 z-40 max-h-[70vh] overflow-hidden rounded-b-lg border-x border-b border-[#e9edc9] bg-white/95 opacity-0 shadow-xl backdrop-blur transition will-change-transform md:mx-auto md:max-w-3xl"
        style="top: calc(var(--header-height) + 0.25rem)"
        aria-hidden="true"
    >
        <div class="flex items-center gap-3 border-b border-[#e9edc9] px-4 py-3">
            <svg
                aria-hidden="true"
                class="h-5 w-5 text-[#d4a373]"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <circle cx="11" cy="11" r="7"></circle>
                <line x1="20" y1="20" x2="16.5" y2="16.5"></line>
            </svg>
            <input
                type="search"
                data-search-input
                placeholder="Search fabrics, categories, or pages..."
                class="h-10 w-full rounded-md border border-transparent bg-[#fefae0] px-3 text-sm text-slate-800 placeholder:text-slate-400 focus:border-[#d4a373] focus:outline-none focus:ring-2 focus:ring-[#d4a373]/50"
            />
            <button type="button" data-search-close class="rounded-full bg-[#e9edc9] px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-600 transition hover:bg-[#ccd5ae]">
                Esc
            </button>
        </div>
        <ul data-search-results class="space-y-1 overflow-y-auto px-4 py-4 text-sm" role="listbox" aria-label="Search suggestions"></ul>
    </section>
</header>

<script>
    // Highlight active navigation link based on current page
    function setActiveNavLink() {
        const currentPath = window.location.pathname;
        
        // Get all nav links (both desktop and mobile)
        const desktopNavLinks = document.querySelectorAll('[data-site-header] nav a');
        const mobileNavLinks = document.querySelectorAll('#mobile-menu nav a');
        
        // Function to set active class
        const activateLink = (link: HTMLAnchorElement) => {
            const linkPath = new URL(link.href).pathname;
            
            // Exact match or home page
            if (linkPath === currentPath || 
                (currentPath === '/' && linkPath === '/') ||
                (currentPath !== '/' && linkPath !== '/' && currentPath.startsWith(linkPath))) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        };
        
        // Apply to desktop nav
        desktopNavLinks.forEach(link => activateLink(link as HTMLAnchorElement));
        
        // Apply to mobile nav
        mobileNavLinks.forEach(link => activateLink(link as HTMLAnchorElement));
    }
    
    // Run on page load
    setActiveNavLink();
    
    // Run on navigation (for SPA-like behavior if needed)
    document.addEventListener('astro:page-load', setActiveNavLink);
</script>
